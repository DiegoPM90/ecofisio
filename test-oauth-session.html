<!DOCTYPE html>
<html>
<head>
    <title>Test Google OAuth Session</title>
</head>
<body>
    <h1>Google OAuth Session Test</h1>
    
    <div id="status">Checking authentication status...</div>
    
    <button onclick="testGoogleLogin()">Test Google Login</button>
    <button onclick="checkAuthStatus()">Check Auth Status</button>
    <button onclick="testLogout()">Test Logout</button>
    
    <div id="results"></div>

    <script>
        async function checkAuthStatus() {
            try {
                const response = await fetch('/api/auth/me', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                document.getElementById('status').innerHTML = 
                    response.ok ? 
                    `✅ Authenticated: ${data.user?.email}` : 
                    `❌ Not authenticated: ${data.error}`;
                    
                document.getElementById('results').innerHTML = 
                    `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                document.getElementById('status').innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        function testGoogleLogin() {
            window.location.href = '/api/auth/google';
        }
        
        async function testLogout() {
            try {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    credentials: 'include'
                });
                await checkAuthStatus();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }
        
        // Check status on page load
        checkAuthStatus();
        
        // Check for login success in URL
        const params = new URLSearchParams(window.location.search);
        if (params.get('login') === 'google_success') {
            setTimeout(() => {
                checkAuthStatus();
            }, 1000);
        }
    </script>
</body>
</html>